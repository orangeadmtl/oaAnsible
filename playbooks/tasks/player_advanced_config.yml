---
# Advanced Player Configuration Tasks
# Enhances the existing opi-setup player functionality

- name: Check current player configuration
  ansible.builtin.stat:
    path: "{{ orangepi_project_root }}/config"
  register: player_config_exists

- name: Verify slideshow-player service
  ansible.builtin.systemd:
    name: slideshow-player.service
  register: player_service_status
  failed_when: false

- name: Configure player auto-restart schedule
  ansible.builtin.cron:
    name: "OrangePi Player Auto Restart"
    minute: "0"
    hour: "4"
    job: "systemctl restart slideshow-player.service"
    user: root
  become: true

- name: Create player monitoring script
  ansible.builtin.template:
    src: player_monitor.sh.j2
    dest: "{{ orangepi_project_root }}/util-scripts/oaplayermon"
    owner: "{{ orangepi_user }}"
    group: "{{ orangepi_user }}"
    mode: "0755"
  become: true

- name: Display player configuration status
  ansible.builtin.debug:
    msg: |
      [MEDIA] Player Configuration:
      ├─ Service Status: {{ 'Running' if player_service_status.status.ActiveState == 'active' else 'Stopped' }}
      ├─ Auto-restart: Scheduled for 4:00 AM daily
      └─ Monitoring: oaplayermon utility available
