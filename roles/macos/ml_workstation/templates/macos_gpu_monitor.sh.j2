#!/bin/bash
# macOS GPU Monitoring Script for Apple Silicon
# Generated by Ansible oaAnsible/roles/macos/ml_workstation

echo "[MACOS] macOS GPU Monitor"
echo "==================="

# Check if running on Apple Silicon
if [[ $(uname -m) == "arm64" ]]; then
    echo "Platform: Apple Silicon"
    
    # GPU information via system_profiler
    echo ""
    echo "GPU Information:"
    system_profiler SPDisplaysDataType | grep -E "(Chipset Model|VRAM|Metal)" | head -5
    
    # Memory pressure
    echo ""
    echo "Memory Pressure:"
    memory_pressure
    
    # CPU usage
    echo ""
    echo "CPU Usage:"
    top -l 1 | grep "CPU usage"
    
    # Temperature (if available)
    echo ""
    echo "Temperature Info:"
    if command -v powermetrics >/dev/null 2>&1; then
        sudo powermetrics -i 1000 -n 1 --samplers smc 2>/dev/null | grep -i temp | head -3 || echo "Temperature monitoring requires sudo access"
    else
        echo "Temperature monitoring not available"
    fi
else
    echo "Platform: Intel Mac"
    echo "GPU monitoring limited on Intel platforms"
fi

echo ""
echo "Use Activity Monitor for detailed GPU usage information"