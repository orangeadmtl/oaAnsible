#!/bin/bash
# Service management aliases for Parking Monitor
# Generated by Ansible
# 
# Usage: source this file to add parking monitor management commands
# Example: source {{ parking_monitor_repository.destination }}/scripts/aliases.sh

# Service configuration
PARKING_MONITOR_DIR="{{ parking_monitor_repository.destination }}"
PARKING_MONITOR_SERVICE="{{ parking_monitor_service.name }}"
PARKING_MONITOR_PORT="{{ parking_monitor_service.port }}"

# Aliases for service management
alias pm-start="launchctl load {{ parking_monitor_launchd.plist_path }}"
alias pm-stop="launchctl unload {{ parking_monitor_launchd.plist_path }}"
alias pm-restart="pm-stop && sleep 2 && pm-start"
alias pm-status="launchctl list | grep '$PARKING_MONITOR_SERVICE'"
alias pm-logs="tail -f '$PARKING_MONITOR_DIR/logs/parking_monitor.log'"
alias pm-health="curl -s http://localhost:$PARKING_MONITOR_PORT/health | python3 -m json.tool"
alias pm-config="open '$PARKING_MONITOR_DIR/config.yaml'"

# Directory navigation
alias pm-dir="cd '$PARKING_MONITOR_DIR'"
alias pm-scripts="cd '$PARKING_MONITOR_DIR/scripts'"
alias pm-logs-dir="cd '$PARKING_MONITOR_DIR/logs'"

# Service inspection
alias pm-ps="pgrep -fl parking_monitor"
alias pm-port="lsof -i :$PARKING_MONITOR_PORT"
alias pm-env="launchctl export | grep PARKING"

# Development helpers
alias pm-tail-error="tail -f '$PARKING_MONITOR_DIR/logs/parking_monitor.log' | grep ERROR"
alias pm-stats="curl -s http://localhost:$PARKING_MONITOR_PORT/api/stats | python3 -m json.tool"

# Quick actions
pm-quick-restart() {
    echo "🔄 Quick restarting Parking Monitor..."
    pm-stop 2>/dev/null
    sleep 2
    pm-start
    sleep 3
    pm-health
}

pm-debug() {
    echo "🔍 Parking Monitor Debug Info:"
    echo "================================"
    echo "Service Status:"
    pm-status || echo "  Service not loaded"
    echo
    echo "Process Status:"
    pm-ps || echo "  No processes found"
    echo
    echo "Port Status:"
    pm-port || echo "  Port not in use"
    echo
    echo "Health Check:"
    pm-health 2>/dev/null || echo "  Health endpoint not responding"
    echo
    echo "Recent Logs (last 10 lines):"
    tail -10 "$PARKING_MONITOR_DIR/logs/parking_monitor.log" 2>/dev/null || echo "  No log file found"
}

# Display available aliases
pm-help() {
    cat << EOF
🅿️  Parking Monitor Service Management Aliases
============================================

Service Control:
  pm-start      - Start the parking monitor service
  pm-stop       - Stop the parking monitor service  
  pm-restart    - Restart the parking monitor service
  pm-status     - Show service status
  
Monitoring:
  pm-logs       - Follow live logs
  pm-health     - Check service health endpoint
  pm-stats      - Get parking statistics
  pm-ps         - Show running processes
  pm-port       - Show port usage
  
Navigation:
  pm-dir        - Go to parking monitor directory
  pm-scripts    - Go to scripts directory
  pm-logs-dir   - Go to logs directory
  pm-config     - Open configuration file
  
Debug:
  pm-debug      - Show comprehensive debug info
  pm-tail-error - Follow error logs only
  pm-quick-restart - Quick restart with health check
  
Help:
  pm-help       - Show this help message

Environment Variables:
  PARKING_MONITOR_DIR     = $PARKING_MONITOR_DIR
  PARKING_MONITOR_SERVICE = $PARKING_MONITOR_SERVICE
  PARKING_MONITOR_PORT    = $PARKING_MONITOR_PORT
EOF
}

echo "🅿️  Parking Monitor aliases loaded! Type 'pm-help' for available commands."